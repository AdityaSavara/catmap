<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>catmap.solvers.mean_field_solver &mdash; CatMAP 0.2.79 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.2.79',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="CatMAP 0.2.79 documentation" href="../../../index.html" />
    <link rel="up" title="catmap" href="../../catmap.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CatMAP 0.2.79 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../catmap.html" accesskey="U">catmap</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for catmap.solvers.mean_field_solver</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">solver_base</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">catmap.data</span> <span class="kn">import</span> <span class="n">templates</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
<span class="kn">import</span> <span class="nn">mpmath</span> <span class="kn">as</span> <span class="nn">mp</span>
<span class="kn">from</span> <span class="nn">catmap.functions</span> <span class="kn">import</span> <span class="n">numerical_jacobian</span>

<div class="viewcode-block" id="MeanFieldSolver"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver">[docs]</a><span class="k">class</span> <span class="nc">MeanFieldSolver</span><span class="p">(</span><span class="n">SolverBase</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Class for handling mean-field type kinetic models. Can be sub-classed to</span>
<span class="sd">    get functionality for steady-state solutions, sabatier solutions, etc.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="MeanFieldSolver.__init__"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reaction_model</span><span class="o">=</span><span class="n">ReactionModel</span><span class="p">()):</span>
        <span class="n">SolverBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reaction_model</span><span class="p">)</span>
        <span class="n">defaults</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">tolerance</span> <span class="o">=</span> <span class="mf">1e-35</span><span class="p">,</span>
                <span class="n">perturbation_size</span> <span class="o">=</span> <span class="mf">1e-14</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rxm</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log_strings</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">&#39;jacobian_fail&#39;</span><span class="p">:</span>
                            <span class="s">&quot;stagnated or diverging (residual = ${resid}).&quot;</span><span class="o">+</span>\
                            <span class="s">&quot; Assuming Jacobian is 0.&quot;</span><span class="p">,</span>
                            <span class="p">}</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.get_rxn_rates"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.get_rxn_rates">[docs]</a>    <span class="k">def</span> <span class="nf">get_rxn_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coverages</span><span class="p">,</span><span class="n">rate_constants</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            returns list of reaction rate for each elementary reaction</span>
<span class="sd">            based on reaction constants &amp; coverage</span>
<span class="sd">            .. todo:: coverages, rate_constants</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">elementary_rates</span><span class="p">(</span>
                <span class="n">rate_constants</span><span class="p">,</span>
                <span class="n">coverages</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gas_pressures</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_mpfloat</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">ri</span> <span class="k">for</span> <span class="n">ri</span> <span class="ow">in</span> <span class="n">rates</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.get_rate"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.get_rate">[docs]</a>    <span class="k">def</span> <span class="nf">get_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rxn_parameters</span><span class="p">,</span>
            <span class="n">coverages</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verify_coverages</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="o">**</span><span class="n">coverage_kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">coverages</span><span class="p">:</span>
            <span class="n">coverages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">coverages</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Input coverages to use as an initial guess &#39;</span><span class="o">+</span>\
                    <span class="s">&#39;for the solver.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verify_coverages</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">coverages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coverage</span><span class="p">(</span>
                    <span class="n">rxn_parameters</span><span class="p">,</span><span class="n">coverages</span><span class="p">,</span><span class="o">**</span><span class="n">coverage_kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span> <span class="o">=</span> <span class="n">coverages</span>
        <span class="n">rate_constants</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate_constants</span><span class="p">(</span><span class="n">rxn_parameters</span><span class="p">,</span><span class="n">coverages</span><span class="p">)</span>
        <span class="n">rates</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">get_rxn_rates</span><span class="p">(</span><span class="n">coverages</span><span class="p">,</span><span class="n">rate_constants</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">rates</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.get_turnover_frequency"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.get_turnover_frequency">[docs]</a>    <span class="k">def</span> <span class="nf">get_turnover_frequency</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rxn_parameters</span><span class="p">,</span><span class="n">rates</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">verify_coverages</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return list of turnover frequencies of all the gas-phase species</span>
<span class="sd">        :param rates: list of rates of each rxn</span>
<span class="sd">        :type rates: list</span>
<span class="sd">        :param verify_coverages: verify that the species has a certain value for the coverage</span>
<span class="sd">        :type verify_coverages: bool, optional</span>
<span class="sd">        :param rxn_parameters: reaction parameters, see solver-base</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rxn_parameters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">rxn_parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">rates</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rate</span><span class="p">(</span><span class="n">rxn_parameters</span><span class="p">,</span><span class="n">verify_coverages</span><span class="o">=</span><span class="n">verify_coverages</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">gas_to_idxs</span><span class="p">(</span><span class="n">gas</span><span class="p">):</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">rxn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementary_rxns</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">gas</span> <span class="ow">in</span> <span class="n">rxn</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">elif</span> <span class="n">gas</span> <span class="ow">in</span> <span class="n">rxn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">idxs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">idxs</span>

        <span class="k">def</span> <span class="nf">idx_to_rate</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">rates</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">idx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mult</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span>
            <span class="k">elif</span> <span class="n">idx</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">mult</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">return</span> <span class="n">mult</span><span class="o">*</span><span class="n">rates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="n">turnover_freq</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">:</span>
            <span class="n">idxs</span> <span class="o">=</span> <span class="n">gas_to_idxs</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
            <span class="n">tof</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">idx_to_rate</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="n">rates</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">])</span>
            <span class="n">turnover_freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tof</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_turnover_frequency</span> <span class="o">=</span> <span class="n">turnover_freq</span>
        <span class="k">return</span> <span class="n">turnover_freq</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.get_selectivity"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.get_selectivity">[docs]</a>    <span class="k">def</span> <span class="nf">get_selectivity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rxn_parameters</span><span class="p">,</span><span class="n">weights</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return list of selectivity of each reaction</span>
<span class="sd">        :param rxn_parameters: reaction parameters, see solver-base</span>
<span class="sd">        :param weights: weights for each species. Defaults to 1 for all species</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_turnover_frequency</span><span class="p">(</span><span class="n">rxn_parameters</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">weights</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">tofs</span><span class="p">)</span> <span class="c">#use for weighted selectivity (e.g. % carbon)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">products</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">,</span><span class="n">tofs</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactants</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reactants</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">,</span><span class="n">tofs</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span> <span class="o">&lt;=</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">prod_rate</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">,</span><span class="n">tofs</span><span class="p">,</span><span class="n">weights</span><span class="p">)</span> <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">products</span><span class="p">])</span>
        <span class="n">reac_rate</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">,</span><span class="n">tofs</span><span class="p">,</span><span class="n">weights</span><span class="p">)</span> <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactants</span><span class="p">])</span>

        <span class="n">selectivities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">w</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">,</span><span class="n">tofs</span><span class="p">,</span><span class="n">weights</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">products</span> <span class="ow">and</span> <span class="n">prod_rate</span><span class="p">:</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">r</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">prod_rate</span>

            <span class="k">elif</span> <span class="n">g</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">reactants</span> <span class="ow">and</span> <span class="n">reac_rate</span><span class="p">:</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="o">*</span><span class="n">w</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="o">/</span><span class="n">reac_rate</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">selectivities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">weights</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_selectivities</span> <span class="o">=</span> <span class="n">selectivities</span>
        <span class="k">return</span> <span class="n">selectivities</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.get_rate_control"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.get_rate_control">[docs]</a>    <span class="k">def</span> <span class="nf">get_rate_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rxn_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return list of degree of rate control for each reaction</span>
<span class="sd">        Ref: Stegelmann et al., DOI: 10.1021/ja9000097</span>
<span class="sd">        :param rxn_parameters: reaction parameters, see solver-base</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kB</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">perturbation_size</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">diff_idxs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">transition_state_names</span><span class="p">))</span>
            <span class="n">dRdG</span> <span class="o">=</span> <span class="n">numerical_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_turnover_frequency</span><span class="p">,</span><span class="n">rxn_parameters</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="p">,</span><span class="n">eps</span><span class="p">,</span><span class="n">diff_idxs</span><span class="o">=</span><span class="n">diff_idxs</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="n">strerror</span><span class="p">:</span>
            <span class="n">resid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">strerror</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">resid</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">resid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;jacobian_fail&#39;</span><span class="p">,</span><span class="n">resid</span><span class="o">=</span><span class="n">resid</span><span class="p">)</span>
            <span class="n">dRdG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">transition_state_names</span><span class="p">)))</span>

        <span class="n">t0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_turnover_frequency</span><span class="p">(</span><span class="n">rxn_parameters</span><span class="p">)</span>
        <span class="n">dRdG</span> <span class="o">*=</span> <span class="o">-</span><span class="n">kT</span>
        <span class="n">dRdG</span> <span class="o">=</span> <span class="n">dRdG</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">DRC</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ti</span><span class="p">,</span> <span class="n">Ji</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span><span class="n">dRdG</span><span class="p">):</span>
           <span class="k">if</span> <span class="n">ti</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">DRC</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">Ji</span><span class="p">))</span>
           <span class="k">else</span><span class="p">:</span>
                <span class="n">DRC</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">Jj</span><span class="o">/</span><span class="n">ti</span><span class="p">)</span> <span class="k">for</span> <span class="n">Jj</span> <span class="ow">in</span> <span class="n">Ji</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">DRC</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.get_interacting_energies"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.get_interacting_energies">[docs]</a>    <span class="k">def</span> <span class="nf">get_interacting_energies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rxn_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the integral energy under high coverage with interactions</span>
<span class="sd">        :param rxn_parameters: reaction parameters, see solver-base</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_ads</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">transition_state_names</span>
        <span class="n">N_ads</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_ads</span><span class="p">)</span>
        <span class="n">energies</span> <span class="o">=</span> <span class="n">rxn_parameters</span><span class="p">[:</span><span class="n">N_ads</span><span class="p">]</span>
        <span class="n">eps_vector</span> <span class="o">=</span> <span class="n">rxn_parameters</span><span class="p">[</span><span class="n">N_ads</span><span class="p">:]</span>
        <span class="n">cvg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coverage</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transition_state_names</span><span class="p">)</span>
        <span class="n">E_int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interaction_function</span><span class="p">(</span><span class="n">cvg</span><span class="p">,</span><span class="n">energies</span><span class="p">,</span><span class="n">eps_vector</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">thermodynamics</span><span class="o">.</span><span class="n">adsorbate_interactions</span><span class="o">.</span><span class="n">interaction_response_function</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">E_int</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.get_selectivity_control"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.get_selectivity_control">[docs]</a>    <span class="k">def</span> <span class="nf">get_selectivity_control</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rxn_parameters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the list of degree of selectivity control for each rxn</span>
<span class="sd">        :param rxn_parameters: reaction parameters, see solver-base</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_kB</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
        <span class="n">eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">perturbation_size</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dSdG</span> <span class="o">=</span> <span class="n">numerical_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_selectivity</span><span class="p">,</span><span class="n">rxn_parameters</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_matrix</span><span class="p">,</span><span class="n">eps</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">,</span><span class="n">strerror</span><span class="p">:</span>
            <span class="n">resid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">strerror</span><span class="p">)</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">resid</span> <span class="o">=</span> <span class="n">resid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">resid</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s">&#39;jacobian_fail&#39;</span><span class="p">,</span><span class="n">resid</span><span class="o">=</span><span class="n">resid</span><span class="p">)</span>
            <span class="n">dRdG</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">transition_state_names</span><span class="p">)))</span>

        <span class="n">s0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_selectivity</span><span class="p">(</span><span class="n">rxn_parameters</span><span class="p">)</span>
        <span class="n">dSdG</span> <span class="o">*=</span> <span class="o">-</span><span class="n">kT</span>
        <span class="n">dSdG</span> <span class="o">=</span> <span class="n">dSdG</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">DSC</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">si</span><span class="p">,</span> <span class="n">Ji</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s0</span><span class="p">,</span><span class="n">dSdG</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">si</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">DSC</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">Ji</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">DSC</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">Jj</span><span class="o">/</span><span class="n">si</span><span class="p">)</span> <span class="k">for</span> <span class="n">Jj</span> <span class="ow">in</span> <span class="n">Ji</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">DSC</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.get_rxn_order"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.get_rxn_order">[docs]</a>    <span class="k">def</span> <span class="nf">get_rxn_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rxn_parameters</span><span class="p">,</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        return the reaction orders for the reactants</span>
<span class="sd">        :param rxn_parameters: reaction parameters, see solver-base</span>
<span class="sd">        :param epsilon: degree of perturbation in pressure</span>
<span class="sd">        :type epsilon: float, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_tofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_turnover_frequency</span><span class="p">(</span><span class="n">rxn_parameters</span><span class="p">)</span>
        <span class="n">current_Ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_pressures</span><span class="p">]</span>
        <span class="n">DRC</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">current_Ps</span><span class="p">):</span>
            <span class="n">new_p</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">current_Ps</span><span class="p">)</span>
            <span class="n">new_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_Ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">epsilon</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rxm</span><span class="o">.</span><span class="n">gas_pressures</span> <span class="o">=</span> <span class="n">new_p</span> <span class="c">##HACK</span>
            <span class="c">#setting self.gas_pressures = new_p inexplicably breaks the solver.</span>
            <span class="n">new_tofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_turnover_frequency</span><span class="p">(</span><span class="n">rxn_parameters</span><span class="p">)</span>
            <span class="n">DRC_i</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">old_tof</span><span class="p">,</span><span class="n">new_tof</span><span class="p">,</span><span class="n">gas</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">current_tofs</span><span class="p">)),</span><span class="n">current_tofs</span><span class="p">,</span><span class="n">new_tofs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">old_tof</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">new_tof</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">dTOF</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dTOF</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_tof</span><span class="o">-</span><span class="n">old_tof</span><span class="p">)</span><span class="o">/</span><span class="n">new_tof</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dTOF</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_tof</span><span class="o">-</span><span class="n">old_tof</span><span class="p">)</span><span class="o">/</span><span class="n">old_tof</span>
                <span class="n">dP</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">current_Ps</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="n">current_Ps</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">DRC_i</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">dTOF</span><span class="o">/</span><span class="n">dP</span><span class="p">))</span>
            <span class="n">DRC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DRC_i</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rxm</span><span class="o">.</span><span class="n">gas_pressures</span> <span class="o">=</span> <span class="n">current_Ps</span> <span class="c">##HACK</span>
        <span class="c">#setting self.gas_pressures = current_Ps inexplicably breaks the solver.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rxn_order</span> <span class="o">=</span> <span class="n">DRC</span>
        <span class="k">return</span> <span class="n">DRC</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.get_apparent_activation_energy"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.get_apparent_activation_energy">[docs]</a>    <span class="k">def</span> <span class="nf">get_apparent_activation_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rxn_parameters</span><span class="p">,</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        returns apparent Arrhenius activation energies (in units of R)</span>
<span class="sd">        for production/consumption of each gas phase species.</span>
<span class="sd">        Calculated as</span>
<span class="sd">        E_app = T^2(dlnr_+/dT)=(T^2/r_+)(dr_+/dT), where r+ is the TOF</span>
<span class="sd">        :param rxn_parameters: reaction paramenters, see solver-base</span>
<span class="sd">        :param epsilon: degree of pertubation in temperature</span>
<span class="sd">        :type epsilon: float, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_tofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_turnover_frequency</span><span class="p">(</span><span class="n">rxn_parameters</span><span class="p">)</span>
        <span class="n">current_T</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span>
        <span class="n">new_T</span> <span class="o">=</span> <span class="n">current_T</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">epsilon</span><span class="p">)</span>
        <span class="n">dT</span> <span class="o">=</span> <span class="n">new_T</span><span class="o">-</span><span class="n">current_T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">new_T</span>
        <span class="n">descriptors</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rxm</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">_descriptors</span><span class="p">)</span> <span class="c">#don&#39;t overwrite them, if temperature is a descriptor</span>
        <span class="k">if</span> <span class="s">&#39;temperature&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rxm</span><span class="o">.</span><span class="n">descriptor_names</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rxm</span><span class="o">.</span><span class="n">descriptor_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;temperature&#39;</span><span class="p">)</span>
                <span class="n">descriptors</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_T</span>
        <span class="n">rxn_parameters_newT</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rxm</span><span class="o">.</span><span class="n">scaler</span><span class="o">.</span><span class="n">get_rxn_parameters</span><span class="p">(</span><span class="n">descriptors</span><span class="p">)</span>
        <span class="n">new_tofs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_turnover_frequency</span><span class="p">(</span><span class="n">rxn_parameters_newT</span><span class="p">)</span>
        <span class="n">E_apps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">R</span> <span class="o">=</span> <span class="mf">8.31447e-3</span><span class="o">/</span><span class="mf">96.485307</span><span class="c">#units of eV</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">gas</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">):</span>
            <span class="n">barriers_i</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">dlnTOF</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">new_tofs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="n">mp</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">current_tofs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="c">#this will fail if any of the TOFs are 0.</span>
            <span class="n">E_app</span> <span class="o">=</span> <span class="n">R</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">dlnTOF</span><span class="o">.</span><span class="n">real</span><span class="p">)</span><span class="o">/</span><span class="n">dT</span><span class="o">*</span><span class="p">(</span><span class="n">current_T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">E_apps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">E_app</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">temperature</span> <span class="o">=</span> <span class="n">current_T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_apparent_activation_energy</span> <span class="o">=</span> <span class="n">E_apps</span>
        <span class="c">#self.get_turnover_frequency(rxn_parameters)</span>
        <span class="k">print</span> <span class="n">E_apps</span>
        <span class="k">return</span> <span class="n">E_apps</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.summary_text"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.summary_text">[docs]</a>    <span class="k">def</span> <span class="nf">summary_text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stub for producing solver summary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.rate_equation_term"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.rate_equation_term">[docs]</a>    <span class="k">def</span> <span class="nf">rate_equation_term</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">species_list</span><span class="p">,</span><span class="n">rate_constant_string</span><span class="p">,</span><span class="n">d_wrt</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to compose a term in the rate equation - e.g. kf[1]*theta[0]*p[0]</span>
<span class="sd">        :param species_list: list of species in rate equations</span>
<span class="sd">        :type species_list: list</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c">#This clause allows for multiple site types.</span>
        <span class="n">site_indices</span><span class="o">=</span><span class="p">{}</span>

        <span class="n">gas_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">gas</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">gas</span> <span class="ow">in</span> <span class="n">species_list</span> <span class="k">if</span> <span class="n">gas</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">]</span>
        <span class="n">ads_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">ads</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">ads</span> <span class="ow">in</span> <span class="n">species_list</span> <span class="k">if</span> <span class="n">ads</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">]</span>
        <span class="n">sites</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">species_list</span>
                <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="p">]</span> <span class="c">#allows for multiple site types</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gas_idxs</span><span class="o">+</span><span class="n">ads_idxs</span><span class="o">+</span><span class="n">sites</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Undefined species in &#39;</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species_list</span><span class="p">))</span>

        <span class="n">rate_string</span> <span class="o">=</span> <span class="n">rate_constant_string</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">d_wrt</span><span class="p">:</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">gas_idxs</span><span class="p">:</span>
                <span class="n">rate_string</span> <span class="o">+=</span> <span class="s">&#39;*p[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ads_idxs</span><span class="p">:</span>
                <span class="n">rate_string</span> <span class="o">+=</span> <span class="s">&#39;*theta[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
                <span class="n">rate_string</span> <span class="o">+=</span> <span class="s">&#39;*s[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
            <span class="k">return</span> <span class="n">rate_string</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d_idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">d_wrt</span><span class="p">)</span>
            <span class="n">d_site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">d_wrt</span><span class="p">][</span><span class="s">&#39;site&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">d_idx</span> <span class="ow">in</span> <span class="n">ads_idxs</span> <span class="c">#expression is a function of d_wrt</span>
                    <span class="ow">and</span> <span class="n">d_site</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">):</span> <span class="c">#empty site not there -&gt; easy</span>
                <span class="n">multiplier</span> <span class="o">=</span> <span class="n">ads_idxs</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">d_idx</span><span class="p">)</span> <span class="c">#get order</span>
                <span class="n">ads_idxs</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">d_idx</span><span class="p">)</span> <span class="c">#reduce order by 1</span>
                <span class="k">if</span> <span class="n">multiplier</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rate_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">rate_string</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">d_site</span> <span class="ow">in</span> <span class="n">sites</span> <span class="c">#empty site appears,</span>
                    <span class="ow">and</span> <span class="n">d_idx</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ads_idxs</span><span class="p">):</span> <span class="c">#but not the adsorbate</span>
                <span class="n">multiplier</span> <span class="o">=</span> <span class="n">sites</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">d_site</span><span class="p">)</span>
                <span class="n">multiplier</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">multiplier</span> <span class="c">#this accounds for the</span>
                <span class="c">#fact that d_site/d_ads = -1</span>
                <span class="n">sites</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">d_site</span><span class="p">)</span> <span class="c">#reduce the order of site by 1</span>
                <span class="n">rate_string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">rate_string</span>
            <span class="k">elif</span> <span class="p">(</span><span class="n">d_site</span> <span class="ow">in</span> <span class="n">sites</span> <span class="c">#function of adsorbate</span>
                    <span class="ow">and</span> <span class="n">d_idx</span> <span class="ow">in</span> <span class="n">ads_idxs</span><span class="p">):</span> <span class="c">#and function of site (1-theta_i)</span>
                <span class="c">#need to use chain rule...</span>
                <span class="n">ads_mult</span> <span class="o">=</span> <span class="n">ads_idxs</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">d_idx</span><span class="p">)</span>
                <span class="n">site_mult</span> <span class="o">=</span> <span class="n">sites</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">d_site</span><span class="p">)</span><span class="o">*-</span><span class="mi">1</span> <span class="c">#negative 1 to account for</span>
                <span class="c">#d_site/d_ads</span>
                <span class="n">ads_str</span> <span class="o">=</span> <span class="s">&#39;theta[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d_idx</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
                <span class="n">site_str</span> <span class="o">=</span> <span class="s">&#39;s[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">d_site</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
                <span class="n">sites</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sites</span> <span class="k">if</span> <span class="n">s</span> <span class="o">!=</span> <span class="n">d_site</span><span class="p">]</span> <span class="c">#remove d_site</span>
                <span class="c">#from the site list</span>
                <span class="n">ads_idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ads_idxs</span> <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="n">d_idx</span><span class="p">]</span> <span class="c">#remove d_idx</span>
                <span class="c">#for adsorbate list</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">site_mult</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">op</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="n">mult_rule</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">site_mult</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">ads_str</span><span class="o">+</span><span class="n">op</span><span class="o">+</span><span class="s">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">site_str</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">site_mult</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="c"># cvg*d_site</span>
                <span class="n">mult_rule</span> <span class="o">+=</span> <span class="s">&#39; + &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ads_mult</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">site_str</span><span class="o">+</span><span class="s">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">ads_str</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ads_mult</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">+</span> <span class="s">&#39;)&#39;</span>
                <span class="n">rate_string</span> <span class="o">+=</span> <span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">mult_rule</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s">&#39;0&#39;</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">gas_idxs</span><span class="p">:</span>
                <span class="n">rate_string</span> <span class="o">+=</span> <span class="s">&#39;*p[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">ads_idxs</span><span class="p">:</span>
                <span class="n">rate_string</span> <span class="o">+=</span> <span class="s">&#39;*theta[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sites</span><span class="p">:</span>
                <span class="n">rate_string</span> <span class="o">+=</span> <span class="s">&#39;*s[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
            <span class="k">return</span> <span class="n">rate_string</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.site_string_list"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.site_string_list">[docs]</a>    <span class="k">def</span> <span class="nf">site_string_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to compose an analytic expression for the coverage of empty sites&quot;&quot;&quot;</span>
        <span class="n">site_strings</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">site_totals</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">site</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="p">:</span>
            <span class="n">site_totals</span><span class="p">[</span><span class="n">site</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mpfloat</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="s">&#39;total&#39;</span><span class="p">])</span>
            <span class="n">site_idxs</span> <span class="o">=</span> <span class="p">[[</span><span class="n">idx</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">ads</span><span class="p">][</span><span class="s">&#39;n_sites&#39;</span><span class="p">]]</span> <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">ads</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">ads</span><span class="p">][</span><span class="s">&#39;site&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">site</span><span class="p">]</span>
            <span class="n">site_str</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">site_totals</span><span class="p">[</span><span class="n">site</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">idx_i</span><span class="p">,</span><span class="n">nsites</span> <span class="ow">in</span> <span class="n">site_idxs</span><span class="p">:</span>
                <span class="n">site_str</span> <span class="o">+=</span> <span class="s">&#39; - theta[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">idx_i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
            <span class="n">site_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">site_str</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">site_strings</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.substitutions_dict"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.substitutions_dict">[docs]</a>    <span class="k">def</span> <span class="nf">substitutions_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dictionary of substitutions needed for static compiled functions&quot;&quot;&quot;</span>
        <span class="n">subdict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">subdict</span><span class="p">[</span><span class="s">&#39;temperature&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;T = &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">temperature</span><span class="p">)</span>
        <span class="n">subdict</span><span class="p">[</span><span class="s">&#39;kB&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;kB = &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_kB</span><span class="p">)</span>
        <span class="n">subdict</span><span class="p">[</span><span class="s">&#39;h&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;h = &#39;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_h</span><span class="p">)</span>
        <span class="n">subdict</span><span class="p">[</span><span class="s">&#39;prefactor_list&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s">&#39;prefactor_list = [&#39;</span> <span class="o">+</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prefactor_list</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;]&#39;</span>
        <span class="n">subdict</span><span class="p">[</span><span class="s">&#39;n_adsorbates&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;n_adsorbates = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">))</span>
        <span class="n">subdict</span><span class="p">[</span><span class="s">&#39;n_transition_states&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;n_transition_states = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transition_state_names</span><span class="p">))</span>

        <span class="n">max_cvg_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ads</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">:</span>
            <span class="n">site</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">ads</span><span class="p">][</span><span class="s">&#39;site&#39;</span><span class="p">]</span>
            <span class="n">default_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">site</span><span class="p">][</span><span class="s">&#39;total&#39;</span><span class="p">]</span>
            <span class="n">max_cvg_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">ads</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;max_coverage&#39;</span><span class="p">,</span><span class="n">default_max</span><span class="p">))</span>
        <span class="n">subdict</span><span class="p">[</span><span class="s">&#39;max_coverage_list&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;max_coverage_list = &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">max_cvg_list</span><span class="p">)</span>

        <span class="n">idx_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">surf_species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">transition_state_names</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="n">q</span><span class="p">:</span>
                    <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">surf_species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">surf_species</span> <span class="k">if</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="s">&#39;site&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">idxs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_interaction_model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;ideal&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">]:</span>
                            <span class="n">default_params</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">thermodynamics</span><span class="o">.</span><span class="n">adsorbate_interactions</span><span class="p">,</span>
                                    <span class="s">&#39;interaction_response_parameters&#39;</span><span class="p">,{})</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">default_params</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">F_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;interaction_response_parameters&#39;</span><span class="p">,</span><span class="n">default_params</span><span class="p">)</span>
                        <span class="n">idx_dict</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxs</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s">&#39;total&#39;</span><span class="p">],</span><span class="n">F_params</span><span class="p">]</span>

                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_interaction_model</span> <span class="o">==</span> <span class="s">&#39;second_order&#39;</span> <span class="ow">and</span> <span class="s">&#39;g&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">q</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="p">,</span><span class="n">q</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx_dict</span> <span class="ow">and</span> <span class="s">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">q</span><span class="p">,</span><span class="n">s</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">idx_dict</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="s">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">s</span><span class="p">,</span><span class="n">q</span><span class="p">])</span>
                        <span class="n">idxs</span> <span class="o">=</span> <span class="p">[</span><span class="n">surf_species</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">surf_species</span> <span class="k">if</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">a</span><span class="p">][</span><span class="s">&#39;site&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">q</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="n">idxs</span><span class="p">:</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_interaction_model</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;ideal&#39;</span><span class="p">,</span><span class="bp">None</span><span class="p">]:</span>
                                <span class="n">default_params</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
                                        <span class="bp">self</span><span class="o">.</span><span class="n">thermodynamics</span><span class="o">.</span><span class="n">adsorbate_interactions</span><span class="p">,</span>
                                        <span class="s">&#39;interaction_response_parameters&#39;</span><span class="p">,{})</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">default_params</span> <span class="o">=</span> <span class="p">{}</span>

                            <span class="n">cirp</span> <span class="o">=</span> <span class="s">&#39;cross_interaction_response_parameters&#39;</span>
                            <span class="k">if</span> <span class="n">cirp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
                                <span class="n">F_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">cirp</span><span class="p">][</span><span class="n">q</span><span class="p">]</span>
                            <span class="k">elif</span> <span class="n">cirp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">q</span><span class="p">]:</span>
                                <span class="n">F_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="n">cirp</span><span class="p">][</span><span class="n">s</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">print</span><span class="p">((</span><span class="s">&#39;Warning: No cross-site interaction params specified&#39;</span>
                                        <span class="s">&#39; for {s},{q}. Assuming interaction params of {s}.&#39;</span><span class="p">)</span>
                                        <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">**</span><span class="nb">locals</span><span class="p">()))</span>
                                <span class="n">F_params</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                                    <span class="s">&#39;interaction_response_parameters&#39;</span><span class="p">,</span><span class="n">default_params</span><span class="p">)</span>

                            <span class="n">max_cvg</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">s</span><span class="p">][</span>
                                <span class="s">&#39;total&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_definitions</span><span class="p">[</span><span class="n">q</span><span class="p">][</span><span class="s">&#39;total&#39;</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span>

                            <span class="n">idx_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">idxs</span><span class="p">,</span><span class="n">max_cvg</span><span class="p">,</span><span class="n">F_params</span><span class="p">]</span>

        <span class="n">subdict</span><span class="p">[</span><span class="s">&#39;site_info_dict&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="s">&#39;site_info_dict = &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">idx_dict</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">subdict</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.rate_equations"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.rate_equations">[docs]</a>    <span class="k">def</span> <span class="nf">rate_equations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compose analytical expressions for the reaction rates and</span>
<span class="sd">        change of surface species wrt time (dc/dt).</span>
<span class="sd">        Assumes:</span>

<span class="sd">        kf is defined as a list of forward rate-constants</span>
<span class="sd">        kr is defined as a list of reverse rate-constants</span>
<span class="sd">        theta is defined as a list of coverages</span>
<span class="sd">        p is defined as a list of pressures</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">site_strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_string_list</span><span class="p">()</span>

        <span class="n">rate_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">rate_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;s = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">site_strings</span><span class="p">):</span>
            <span class="n">rate_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;s[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = &#39;</span><span class="o">+</span><span class="n">site_strings</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">rxn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementary_rxns</span><span class="p">):</span>
            <span class="n">fRate_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_equation_term</span><span class="p">(</span><span class="n">rxn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;kf[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
            <span class="n">rRate_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_equation_term</span><span class="p">(</span><span class="n">rxn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;kr[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
            <span class="n">rateString</span> <span class="o">=</span> <span class="s">&#39;r[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = &#39;</span><span class="o">+</span><span class="n">fRate_string</span> <span class="o">+</span> <span class="s">&#39; - &#39;</span> <span class="o">+</span> <span class="n">rRate_string</span>
            <span class="n">rate_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rateString</span><span class="p">)</span>

        <span class="n">dcdt_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ads</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">):</span>
            <span class="n">dcdt_str</span> <span class="o">=</span> <span class="s">&#39;dtheta_dt[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = &#39;</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">rxn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementary_rxns</span><span class="p">):</span>
                <span class="n">rxnCounts</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">rxn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">ads</span><span class="p">),</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">rxn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">ads</span><span class="p">)]</span>
                <span class="n">rxnOrder</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">rxnCounts</span> <span class="k">if</span> <span class="n">o</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">rxnOrder</span><span class="p">:</span>
                    <span class="n">rxnOrder</span> <span class="o">=</span> <span class="n">rxnOrder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">dcdt_str</span> <span class="o">+=</span> <span class="s">&#39; + &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rxnOrder</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;*r[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span>
            <span class="k">if</span> <span class="n">dcdt_str</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;= &#39;</span><span class="p">):</span>
                <span class="n">dcdt_str</span> <span class="o">+=</span> <span class="s">&#39;0&#39;</span>
            <span class="n">dcdt_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dcdt_str</span><span class="p">)</span>

        <span class="n">all_strings</span> <span class="o">=</span> <span class="n">rate_strings</span> <span class="o">+</span> <span class="n">dcdt_strings</span>
        <span class="k">return</span> <span class="n">all_strings</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.jacobian_equations"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.jacobian_equations">[docs]</a>    <span class="k">def</span> <span class="nf">jacobian_equations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">adsorbate_interactions</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Composes analytical expressions for the Jacobian matrix.</span>
<span class="sd">        Assumes:</span>

<span class="sd">        kf is defined as a list of forward rate-constants</span>
<span class="sd">        kr is defined as a list of reverse rate-constants</span>
<span class="sd">        theta is defined as a list of coverages</span>
<span class="sd">        p is defined as a list of pressures</span>

<span class="sd">        If the rate constants depend on coverage, use</span>
<span class="sd">        adsorbate_interactions = True.</span>
<span class="sd">        Assumes:</span>

<span class="sd">        kB is defined as Boltzmann&#39;s constant</span>
<span class="sd">        T is defined as the temperature</span>
<span class="sd">        dEf is defined as a list of lists where dEf[i][j] is the</span>
<span class="sd">            derivative of forward activation free energy i wrt coverage j</span>
<span class="sd">        dEr is defined as a list of lists where dEr[i][j] is the</span>
<span class="sd">            derivative of reverse activation free energy i wrt coverage j</span>
<span class="sd">        :param: adsorbate_interactions: tell if need to include interactions</span>
<span class="sd">        :type: adsorbate_interactions: bool, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">site_strings</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_string_list</span><span class="p">()</span>

        <span class="n">J_strings</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">J_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;s = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="p">)))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">site_strings</span><span class="p">):</span>
            <span class="n">J_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;s[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = &#39;</span><span class="o">+</span><span class="n">site_strings</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">adsorbate_interactions</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">J_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;kfkBT = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementary_rxns</span><span class="p">)))</span>
            <span class="n">J_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;krkBT = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementary_rxns</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementary_rxns</span><span class="p">)):</span>
                <span class="n">J_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;kfkBT[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = kf[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]/kBT&#39;</span><span class="p">)</span>
                <span class="n">J_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;krkBT[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = kr[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]/kBT&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ads_i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">ads_j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">):</span>
                <span class="n">J_str</span> <span class="o">=</span> <span class="s">&#39;J[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;][&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = 0&#39;</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">rxn</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementary_rxns</span><span class="p">):</span>
                    <span class="n">rxnCounts</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">rxn</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">ads_i</span><span class="p">),</span>
                            <span class="mf">1.0</span><span class="o">*</span><span class="n">rxn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">ads_i</span><span class="p">)]</span>
                    <span class="n">rxnOrder</span> <span class="o">=</span> <span class="p">[</span><span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">rxnCounts</span> <span class="k">if</span> <span class="n">o</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">rxnOrder</span><span class="p">:</span>
                        <span class="n">rxnOrder</span> <span class="o">=</span> <span class="n">rxnOrder</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="n">fRate_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_equation_term</span><span class="p">(</span><span class="n">rxn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;kf[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="n">ads_j</span><span class="p">)</span>
                        <span class="n">rRate_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_equation_term</span><span class="p">(</span><span class="n">rxn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;kr[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">,</span><span class="n">ads_j</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">adsorbate_interactions</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                            <span class="n">dfRate_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_equation_term</span><span class="p">(</span><span class="n">rxn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;(kfkBT[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;])*dEf[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;][&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
                            <span class="n">drRate_string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_equation_term</span><span class="p">(</span><span class="n">rxn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s">&#39;(krkBT[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;])*dEr[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;][&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
                            <span class="n">fRate_string</span> <span class="o">+=</span> <span class="s">&#39; + &#39;</span> <span class="o">+</span> <span class="n">dfRate_string</span>
                            <span class="n">rRate_string</span> <span class="o">+=</span> <span class="s">&#39; - &#39;</span> <span class="o">+</span> <span class="n">drRate_string</span>
                        <span class="k">if</span> <span class="n">fRate_string</span> <span class="o">!=</span> <span class="s">&#39;0&#39;</span> <span class="ow">and</span> <span class="n">rRate_string</span> <span class="o">!=</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                            <span class="n">dr_dx</span> <span class="o">=</span> <span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">fRate_string</span> <span class="o">+</span> <span class="s">&#39; - &#39;</span> <span class="o">+</span> <span class="n">rRate_string</span><span class="o">+</span><span class="s">&#39;)&#39;</span>
                        <span class="k">elif</span> <span class="n">fRate_string</span> <span class="o">!=</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                            <span class="n">dr_dx</span> <span class="o">=</span> <span class="n">fRate_string</span>
                        <span class="k">elif</span> <span class="n">rRate_string</span> <span class="o">!=</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                            <span class="n">dr_dx</span> <span class="o">=</span> <span class="s">&#39;-1*&#39;</span><span class="o">+</span><span class="n">rRate_string</span>
                        <span class="k">elif</span> <span class="n">fRate_string</span> <span class="o">==</span> <span class="n">rRate_string</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>
                            <span class="n">dr_dx</span> <span class="o">=</span> <span class="bp">None</span>
                        <span class="k">if</span> <span class="n">dr_dx</span><span class="p">:</span>
                            <span class="n">J_str</span> <span class="o">+=</span> <span class="s">&#39; + &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">rxnOrder</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">dr_dx</span>
                <span class="n">J_strings</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">J_str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">J_strings</span>
</div>
<div class="viewcode-block" id="MeanFieldSolver.reaction_energy_equations"><a class="viewcode-back" href="../../../reference/catmap.solvers.html#catmap.solvers.mean_field_solver.MeanFieldSolver.reaction_energy_equations">[docs]</a>    <span class="k">def</span> <span class="nf">reaction_energy_equations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">adsorbate_interactions</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Composes a list of analytical expressions which give the reaction</span>
<span class="sd">        and activation energies for elementary steps. Note that while this</span>
<span class="sd">        is useful primarily for models with adsorbate-interactions</span>
<span class="sd">        (otherwise these energetics can easily be obtained by the reaction</span>
<span class="sd">        model itself), they are technically valid for all mean-field models.</span>
<span class="sd">        Assumes:</span>

<span class="sd">        Gf is a list of formation energies ordered as</span>
<span class="sd">            adsorbate_names+transition_state_names</span>

<span class="sd">        If model includes adsorbate interactions then use</span>
<span class="sd">        adsorbate_interactions = True to include dEa/dtheta in the output.</span>
<span class="sd">        Assumes:</span>

<span class="sd">        dGs is a matrix/array of derivatives of free energies wrt coverages</span>
<span class="sd">            such that dGs[:,i] is a vector of derivatives of the free energy</span>
<span class="sd">            of species i wrt each coverage ordered as adsorbate_names</span>

<span class="sd">        :param: adsorbate_interaction: specify whether or not to include interactions</span>
<span class="sd">        :type: adsorbate_interaction: bool, optional</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">idx_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">ads</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">):</span>
            <span class="n">idx_dict</span><span class="p">[</span><span class="n">ads</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">TS</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">transition_state_names</span><span class="p">):</span>
            <span class="n">idx_dict</span><span class="p">[</span><span class="n">TS</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">))</span>

        <span class="n">expressions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n_rxns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementary_rxns</span><span class="p">)</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;G_IS = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_rxns</span><span class="p">))</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;G_TS = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_rxns</span><span class="p">))</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;G_FS = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_rxns</span><span class="p">))</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;G_af = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_rxns</span><span class="p">))</span>
        <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;G_ar = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_rxns</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">adsorbate_interactions</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;dG_IS = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_rxns</span><span class="p">))</span>
            <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;dG_TS = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_rxns</span><span class="p">))</span>
            <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;dG_FS = [0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">n_rxns</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">species_strings</span><span class="p">(</span><span class="n">state_list</span><span class="p">,</span><span class="n">list_name</span><span class="p">,</span><span class="n">include_constants</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;list&#39;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            return the strings containing the IS, TS and FS for the reactions</span>
<span class="sd">            :param: include_constants: tell if need to include the energies</span>
<span class="sd">            :type: include_constants: bool, optional</span>
<span class="sd">            :param: type: the output type</span>
<span class="sd">            :type: type: string, optional</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="n">species_strs</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">state_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="n">idx_dict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&#39;list&#39;</span><span class="p">:</span>
                        <span class="n">species_strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_name</span><span class="o">+</span><span class="s">&#39;[&#39;</span><span class="o">+</span><span class="n">idx_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&#39;matrix_row&#39;</span><span class="p">:</span>
                        <span class="n">species_strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_name</span><span class="o">+</span><span class="s">&#39;[&#39;</span><span class="o">+</span><span class="n">idx_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;,:]&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&#39;matrix_col&#39;</span><span class="p">:</span>
                        <span class="n">species_strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_name</span><span class="o">+</span><span class="s">&#39;[:,&#39;</span><span class="o">+</span><span class="n">idx_dict</span><span class="p">[</span><span class="n">species</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">include_constants</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">species</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gas_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
                        <span class="n">species_strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;gas_energies[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">species</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="p">:</span>
                        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
                        <span class="n">species_strs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;site_energies[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Undefined species &#39;</span><span class="o">+</span><span class="n">species</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">species_strs</span><span class="p">:</span>
                <span class="n">species_strs</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;[0]*&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adsorbate_names</span><span class="p">))]</span>
            <span class="k">return</span> <span class="n">species_strs</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">rx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elementary_rxns</span><span class="p">):</span>
            <span class="n">IS</span> <span class="o">=</span> <span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">FS</span> <span class="o">=</span> <span class="n">rx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">TS</span> <span class="o">=</span> <span class="n">rx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">TS</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="n">txt</span> <span class="o">=</span> <span class="s">&#39;G_IS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = &#39;</span> <span class="o">+</span> <span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species_strings</span><span class="p">(</span><span class="n">IS</span><span class="p">,</span><span class="s">&#39;Gf&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span>
            <span class="n">txt</span> <span class="o">+=</span> <span class="s">&#39;G_FS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = &#39;</span> <span class="o">+</span> <span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species_strings</span><span class="p">(</span><span class="n">FS</span><span class="p">,</span><span class="s">&#39;Gf&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span>
            <span class="k">if</span> <span class="n">adsorbate_interactions</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s">&#39;dG_IS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = element_wise_addition([&#39;</span> <span class="o">+</span> <span class="s">&#39; , &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species_strings</span><span class="p">(</span><span class="n">IS</span><span class="p">,</span><span class="s">&#39;dGs&#39;</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="s">&#39;list&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;])</span><span class="se">\n</span><span class="s">    &#39;</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s">&#39;dG_FS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = element_wise_addition([&#39;</span> <span class="o">+</span> <span class="s">&#39; , &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species_strings</span><span class="p">(</span><span class="n">FS</span><span class="p">,</span><span class="s">&#39;dGs&#39;</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="s">&#39;list&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;])</span><span class="se">\n</span><span class="s">    &#39;</span>
            <span class="k">if</span> <span class="n">TS</span><span class="p">:</span>
                <span class="n">TS_strings</span> <span class="o">=</span> <span class="n">species_strings</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span><span class="s">&#39;Gf&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s">&#39;G_TS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = &#39;</span> <span class="o">+</span> <span class="s">&#39; + &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species_strings</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span><span class="s">&#39;Gf&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span>
                <span class="k">if</span> <span class="n">adsorbate_interactions</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s">&#39;dG_TS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = element_wise_addition([&#39;</span> <span class="o">+</span> <span class="s">&#39; , &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">species_strings</span><span class="p">(</span><span class="n">TS</span><span class="p">,</span><span class="s">&#39;dGs&#39;</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="s">&#39;list&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;])</span><span class="se">\n</span><span class="s">    &#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">txt</span> <span class="o">+=</span> <span class="s">&#39;G_TS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = max([G_IS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;],G_FS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;]])&#39;</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">    &#39;</span>
                <span class="k">if</span> <span class="n">adsorbate_interactions</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">txt</span> <span class="o">+=</span> <span class="s">&#39;dG_TS[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;] = None #determined later</span><span class="se">\n</span><span class="s">    &#39;</span>

            <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; + 0&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">expressions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expressions</span>
</pre></div></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CatMAP 0.2.79 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../../catmap.html" >catmap</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Andrew J. Medford.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>